## 实模式切换到保护模式

### 前言
上节课我们讲了启动区读取整个操作系统和应用程序到内存中，并且跳转到操作系统开始的程序，这里我们都是在实模式下进行，内存访问也才1M，寄存器大小大都是16位宽，且CPU也并不提供保护机制，所以我们需要切换到保护模式下，也可以更好的使用C语言来编写程序。

### 知识储备
#### 内存分段
**寄存器**<br>
讲内存分段前我们先简单说一下寄存器，一般来说寄存器分为两个大的类别，段寄存器和通用寄存器
通用寄存器：
```
AX——accumulator，累加寄存器
CX——counter，计数寄存器
DX——data，数据寄存器
BX——base，基址寄存器
SP——stack pointer，栈指针寄存器
BP——base pointer，基址指针寄存器
SI——source index，源变址寄存器
DI——destination index，目的变址寄存器
```
这些寄存器可以在运算过程中使用，都是16位的<br>
AX, BX, CX, DX又可以分为两个高低位的寄存器，例如AX可以分为AH,AL。AH指向的时AX高8位，AL指向的时AX的低8位。

段寄存器：
```
ES——附加段寄存器（extra segment）
CS——代码段寄存器（code segment）
SS——栈段寄存器（stack segment）
DS——数据段寄存器（data segment）
FS——没有名称（segment part 2）
GS——没有名称（segment part 3）
```
这些是段寄存器，这些的用处一般用于段寻址的时候。<br>
这里的段寄存器和通用寄存器都是16宽，也就是在实模式下使用的寄存器都是16宽。32位宽的寄存器需要在这些前边加一个E, EAX, EBX等等，我们切换到保护模式便可以使用32位宽的寄存器。64位宽的寄存器是在前边加一个R，RAX，RBX等等，作者书中并没有涉及到64位的寄存器，这里也不再多说。

**数据段和代码段**<br>
什么是内存分段呢？其实就是内存中划分为一段一段的空间，我们前边学习到使用[CS:IP]的方式去读取内存的指令，同样BIOS读取磁盘到指定内存空间时是使用[ES:BX]来表示。这些都是我们去访问内存的方式，具体来说CS这个寄存器的值表示的段的开始位置，也称为段基址，IP这个指向段内的偏移地址，这样就可以取到相应的指令。
举个例子来说：


#### 实模式和保护模式对比

实模式下只能寻址到1M大小，C语言程序编译成16位的比较麻烦。调用BIOS实现硬件访问

保护模式因为地址总线有32位宽，2^32=4G大小的内存，c语言很容易编译成32位的，可以直接使用C语言编程。无需调用BIOS实现硬件访问。


### 代码跟踪


### 总结